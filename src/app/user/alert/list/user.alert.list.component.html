<div style="display:flex;flex-direction:column;overflow-y:auto;padding:10px 20px 10px 20px">
	<form [formGroup]="alertGroup" novalidate>
		<!-- header -->
		<div style="flex:none">
			<div style="display:flex;flex-direction:row;align-items:center">
				<h4 style="flex:none">Alerts(<ng-container *ngIf="total | async as t"><ng-container [ngSwitch]="t"><ng-container *ngSwitchCase="-1">0</ng-container><ng-container *ngSwitchDefault>{{ t }}</ng-container></ng-container></ng-container>)</h4>
				<div style="flex:1;display:flex;flex-direction:row;justify-content:flex-end;align-items:center">
					<div style="flex:none;margin-right:5px">
						<mat-form-field style="width:150px">
							<mat-select formControlName="type" #select="matSelect" (selectionChange)="changeType()">
								<!-- <mat-select-trigger>{{ select.selected?.value }}</mat-select-trigger> -->
								<mat-option *ngFor="let t of types" [value]="t">{{ t }}</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<back></back>
				</div>
			</div>
		</div>
		<!-- search results -->
		<loading-spinner *ngIf="loading | async"></loading-spinner>
		<div *ngIf="!(loading | async)" style="flex:1;display:flex;flex-direction:column">
			<ng-container *ngIf="alerts | async;let alertItems">
				<div *ngIf="alertItems.length > 0; then showalerts else noalerts"></div>
				<ng-template #showalerts>
					<ng-container *ngFor="let alert of alertItems; trackBy: trackAlerts">
						<div style="flex:none;display:flex;flex-direction:column;margin-bottom:5px">
							<ng-container *ngIf="alert.type == 'Forum';then showforum else showservice"></ng-container>
							<ng-template #showforum>
								<ng-container *ngIf="alert.forum | async;let forum">
									<div class="alert alert-danger" style="flex:none;display:flex;flex-direction:row;align-items:center;flex-wrap:wrap">
										<ng-container *ngIf="forum.defaultForumImage | async; then showdefaultforumimage"></ng-container>
										<ng-template #showdefaultforumimage>
											<ng-container *ngIf="forum.defaultForumImage | async;let image">
												<div style="flex:none;margin-right:10px" (appear)="setViewedAlertFlag(alert)">
													<ng-container *ngIf="image.url == '../../assets/defaultThumbnail.jpg'; then noimage else showimage"></ng-container>
													<ng-template #showimage>
														<img [src]="image.url" [routerLink]="['/forum/detail']" [queryParams]='{ forumId: forum.forumId }' style="cursor:pointer">
													</ng-template>
													<ng-template #noimage>
														<img [src]="image.url">
													</ng-template>
												</div>
											</ng-container>
										</ng-template>
										<div style="flex:1;margin-right:5px">
											<ng-container *ngIf="forum.defaultRegistrant | async; then showdefaultregistrant else nodefaultregistrant"></ng-container>
											<ng-template #showdefaultregistrant>
												<p style="word-break: break-all">
													<a [routerLink]="['/user/forum/view']" [queryParams]="{ userId: forum.uid, forumId: forum.forumId }" style="color:#1B1B1B" matTooltip="{{ forum.title }}">{{ forum.title | noTitle | truncate: 35 }} <i *ngIf="forum.description.length > 0">- {{ forum.description | truncate: 80 }}</i></a>
												</p>
											</ng-template>
											<ng-template #nodefaultregistrant>
												<a *ngIf="forum.type == 'Private'" [routerLink]="['/user/forum/detail']" [queryParams]="{ userId: forum.uid, forumId: forum.forumId }" style="word-break: break-all;color:#1B1B1B" matTooltip="{{ forum.title }}">{{ forum.title | noTitle | truncate: 35}} <i *ngIf="forum.description.length > 0">- {{ forum.description | truncate: 80 }}</i></a>
												<a *ngIf="forum.type == 'Public'" [routerLink]="['/forum/detail']" [queryParams]="{ forumId: forum.forumId }" style="word-break: break-all;color:#1B1B1B" matTooltip="{{ forum.title }}">{{ forum.title | noTitle | truncate: 35 }} <i *ngIf="forum.description.length > 0">- {{ forum.description | truncate: 80 }}</i></a>
											</ng-template>
										</div>
										<div style="flex:none;display:flex;flex-direction:row;align-items:center;flex-wrap:wrap">
											<div style="flex:none;margin-right:5px">
												<div class="label label-default" matTooltip="{{ forum.creationDate.toDate() | date: 'MMM d, y, h:mm:ss a' }}" style="flex:none;padding:5px">
													{{ forum.creationDate.toDate() | amTimeAgo }}
												</div>
											</div>
											<div style="flex:none;margin-right:5px">
												<mat-icon onclick="event.stopPropagation()" (click)="delete(alert)" style="cursor:pointer;color:#1B1B1B" matTooltip="Delete">delete</mat-icon>
											</div>
											<div style="flex:none;margin-right:5px">
												<mat-icon [routerLink]="['/forum/detail']" [queryParams]="{ forumId: forum.forumId }" style="cursor:pointer;color:#1B1B1B" matTooltip="View details">description</mat-icon>
											</div>
										</div>
									</div>
									<ng-container *ngIf="forum.forumTags | async;let forumTagItems">
										<ng-container *ngIf="forumTagItems.length > 0; then showtags"></ng-container>
										<ng-template #showtags>
											<div style="flex:none;display:flex;flex-direction:row">
												<ng-container *ngFor="let forumTag of forumTagItems">
													<span class="label label-danger" style="flex:none;margin-right:5px;padding:5px">{{ forumTag.tag }}</span>
												</ng-container>
											</div>
										</ng-template>
									</ng-container>
								</ng-container>
							</ng-template>
							<ng-template #showservice>
								<ng-container *ngIf="alert.service | async;let service">
									<div [ngClass]="service.paymentType == 'Free' ? 'alert alert-success' : 'alert alert-info'" style="flex:none;display:flex;flex-direction:row;align-items:center;flex-wrap:wrap">
										<ng-container *ngIf="service.defaultServiceImage | async; then showdefaultserviceimage"></ng-container>
										<ng-template #showdefaultserviceimage>
											<ng-container *ngIf="service.defaultServiceImage | async;let image">
												<div style="flex:none;margin-right:10px" (appear)="setViewedAlertFlag(alert)">
													<ng-container *ngIf="image.url == '../../assets/defaultThumbnail.jpg'; then noimage else showimage"></ng-container>
													<ng-template #showimage>
														<img [src]="image.url" [routerLink]="['/service/detail']" [queryParams]='{ serviceId: service.serviceId }' style="cursor:pointer">
													</ng-template>
													<ng-template #noimage>
														<img [src]="image.url">
													</ng-template>
												</div>
											</ng-container>
										</ng-template>
										<div style="flex:1;margin-right:5px">
											<a *ngIf="service.type == 'Private'" [routerLink]="['/user/service/detail']" [queryParams]="{ userId: service.uid, serviceId: service.serviceId }" style="word-break: break-all;color:#1B1B1B" matTooltip="{{ service.title }}">{{ service.title | truncate: 35 }} <i *ngIf="service.description.length > 0">{{ service.description | truncate: 80 }}</i></a>
											<a *ngIf="service.type == 'Public'" [routerLink]="['/service/detail']" [queryParams]="{ serviceId: service.serviceId }" style="word-break: break-all;color:#1B1B1B" matTooltip="{{ service.title }}">{{ service.title | truncate: 35 }} <i *ngIf="service.description.length > 0">{{ service.description | truncate: 80 }}</i></a>
										</div>
										<div style="flex:none;display:flex;flex-direction:row;align-items:center;flex-wrap:wrap">
											<div style="flex:none;margin-right:5px">
												<div class="label label-default" matTooltip="{{ service.creationDate.toDate() | date: 'MMM d, y, h:mm:ss a' }}" style="flex:none;padding:5px">
													{{ service.creationDate.toDate() | amTimeAgo }}
												</div>
											</div>
											<div style="flex:none;margin-right:5px">
													<mat-icon onclick="event.stopPropagation()" (click)="delete(alert)" style="cursor:pointer;color:#1B1B1B" matTooltip="Delete">delete</mat-icon>
												</div>
											<div style="flex:none;margin-right:5px">
												<mat-icon *ngIf="service.type == 'Private'" [routerLink]="['/user/service/detail']" [queryParams]="{ userId: service.uid, serviceId: service.serviceId }" style="cursor:pointer;color:#1B1B1B" matTooltip="View details">description</mat-icon>
												<mat-icon *ngIf="service.type == 'Public'" [routerLink]="['/service/detail']" [queryParams]="{ serviceId: service.serviceId }" style="cursor:pointer;color:#1B1B1B" matTooltip="View details">description</mat-icon>
											</div>
											<div style="flex:none">
												<mat-icon [routerLink]="['/user/forum/new']" [queryParams]="{ userId: service.uid, serviceId: service.serviceId }" style="cursor:pointer;color:#1B1B1B" matTooltip="Create forum">add</mat-icon>
											</div>
										</div>
									</div>
									<div style="flex:none;display:flex;flex-direction:row">
										<ng-container *ngIf="service.serviceTags | async;let serviceTagItems">
											<ng-container *ngIf="serviceTagItems.length > 0; then showservicetags"></ng-container>
											<ng-template #showservicetags>
												<div style="flex:1;display:flex;flex-direction:row;margin-top:5px">
													<ng-container *ngFor="let serviceTag of serviceTagItems">
														<span [ngClass]="service.paymentType == 'Free' ? 'label label-success' : 'label label-info'" style="flex:none;margin-right:5px;padding:5px">{{ serviceTag.tag }}</span>
													</ng-container>
												</div>
											</ng-template>
										</ng-container>
										<ng-container *ngIf="service.paymentType == 'Payment'">
											<div style="flex:none">
												<a [routerLink]="['/user/payment/new']" [queryParams]="{ userId: service.uid, serviceId: service.serviceId }" style="color:#1B1B1B" matTooltip="Buy">{{ service.currency.toUpperCase() }} {{ service.amount.toFixed(2) }}</a>
											</div>
										</ng-container>
									</div>
								</ng-container>
							</ng-template>
						</div>
					</ng-container>
				</ng-template>
				<ng-template #noalerts>
					<p style="flex:none;color:#999;font-size:90%">
						<i>No Alerts</i>
					</p>
				</ng-template>
			</ng-container>
		</div>
		<!-- paging -->
		<div *ngIf='prevKeys?.length || nextKey' style="flex:none;padding:5px;display:flex;flex-direction:row;justify-content:flex-end">		 
			<button style="flex:none" (click)="onPrev()" *ngIf='prevKeys?.length'>Prev</button>
			<button style="flex:none" (click)="onNext()" *ngIf='nextKey'>Next</button>
		</div>
	</form>
</div>